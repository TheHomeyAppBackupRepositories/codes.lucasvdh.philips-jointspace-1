<script>
    let creatingDevice = false;

    Homey.setTitle('Adding device...');
    Homey.emit('almost_done', null, (err, device) => {
        if (err) {
            console.log(err);
            return;
        }

        if (creatingDevice) {
            console.log('Already creating device');
            return;
        }
        creatingDevice = true;

        Homey.createDevice(device, (err, res) => {
            if (err) {
                console.log(err);
                return;
            }
            Homey.done();
        })
    });
</script>